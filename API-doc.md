# Требования к API
### Базовые требования:
1. URL запросов формируется так: 
<*Базовый URL*>/<*Версия запроса*>/<*путь*>
Базовый URL = https://dricom.ru/api/
Например: https://dricom.ru/api/1/register
2. Каждый запрос должен завершиться с соответствующим кодом и вернуть JSON объект. 
    - В случае успеха 
        - HTTP код 2xx (например 200 OK) или 3xx (например 304 Not modified)
        - тип возвращаемого объекта определяется для конкретного запроса
    - В случае ошибки
        - HTTP код 4xx (например 401 Unauthorized) или 5xx в случае ошибки на сервере 
        - объект Error с полями *code* (Int) и *message* (String). Пример:
    ```json
	{
		"error": {
			"code": 401, 
			"message": "Необходима авторизация в приложении"
		}
	}
	```
3.  Для запросов, требующих обязательной авторизации, клиент добавляет header X-session с id сессии, полученным при аутентификации.
### Описание методов API
#### Регистрация нового пользователя.
`POST /1/register`

|Параметр|Обязательность|Расположение|Тип    |Описание
|--------|--------------|------------|-------|---
|name    |      v       |formData    |String |Имя пользователя
|license |      v       |formData    |String |Номер автомобиля
|phone   |      v       |formData    |String |Номер телефона
|email   |      v       |formData    |String |Адрес электронной почты
|password|      v       |formData    |String |Пароль
|token   |              |formData    |String |токен для push-уведомлений

Схема ответа: `user.register.v.1`
```json
{
	"user": {
		"name": "Ivan Bondar",
		"license": "P245YC77RUS",
		"phone": "+79055656146",
		"email": "ivan@mail.ru"
	},
	"session": "kjdf8374jdf9893843jjdff98"
}
```
> По поводу сессии надо подумать и обсудить этот вопрос отдельно. Суть в том, чтобы каким-то образом подписывать запросы авторизованной зоны.

Код ответа|Описание
----------|---
200       |OK
403       | Неверные параметры регистрации.

>Нужно проверить что все значения уникальны.
Должно приходить нормальное сообщение, например "Пользователь с таким мобильным телефоном уже зарегистрирован" - тексты думаю самим можно придумывать, потом Федор подправит если что.
Здесь нужно обсудить как делать валидацию формата полей (телефон, номер, email, пароль возможно). Правильный вариант - на сервере, но для экономии времени можем сначала сделать на клиенте. Кроме того, пароль не стоит передавать и хранить в открытом виде, можно передавать hash пароля.

Пока хватит. С картинками потом придумаем.
#### Аутентификация
`POST /1/auth`

|Параметр|Обязательность|Расположение|Тип    |Описание
|--------|--------------|------------|-------|---
|name    |      v       |formData    |String |Имя пользователя
|password|      v       |formData    |String |Пароль
|token   |              |formData    |String |токен для push-уведомлений
Схема ответа: `user.login.v.1` 
```json
{
	"user": {
		"name": "Ivan Bondar",
		"license": "P245YC77RUS",
		"phone": "+79055656146",
		"email": "ivan@mail.ru"
	},
	"session": "kjdf8374jdf9893843jjdff98"
}
```
>формат совпадает с регистрацией, но лучше сделать 2 разных типа

Код ответа|Описание
----------|---
200       |OK
403       |Неверная пара логин/пароль. Или не заполнено одно из полей.
#### Поиск пользователя
`GET /1/users/search`
*Запрос требует авторизации*

|Параметр|Обязательность|Расположение|Тип    |Описание
|--------|--------------|------------|-------|---
|license |      v       |query       |String |Номер водительского удостоверения
Схема ответа: `user.v.1` 
```json
{
	"name": "Ivan Bondar",
	"license": "P245YC77RUS",
	"userId": "123456",
	"phone": "+79055656146"
}
```
>поле userId будет использоваться для отправки сообщения в мессенджере

Код ответа|Описание
----------|---
200       |OK
404       |Пользователь не найден
403       |Некорректный формат номера
401       |Пользователь не авторизован/сессия истекла
